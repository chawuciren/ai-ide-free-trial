import{g as Fe,u as Z,s as k,d as Ue,c as $e,a as X,b as Ve,e as ge}from"./_commonjsHelpers-2184a9f3.js";import{R as N,H as M}from"./enum-bd484685.js";var ze=function(i){return Ge(i)&&!ke(i)};function Ge(o){return!!o&&typeof o=="object"}function ke(o){var i=Object.prototype.toString.call(o);return i==="[object RegExp]"||i==="[object Date]"||He(o)}var Be=typeof Symbol=="function"&&Symbol.for,qe=Be?Symbol.for("react.element"):60103;function He(o){return o.$$typeof===qe}function We(o){return Array.isArray(o)?[]:{}}function F(o,i){return i.clone!==!1&&i.isMergeableObject(o)?_(We(o),o,i):o}function Ze(o,i,r){return o.concat(i).map(function(d){return F(d,r)})}function Xe(o,i){if(!i.customMerge)return _;var r=i.customMerge(o);return typeof r=="function"?r:_}function Ye(o){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(o).filter(function(i){return Object.propertyIsEnumerable.call(o,i)}):[]}function se(o){return Object.keys(o).concat(Ye(o))}function me(o,i){try{return i in o}catch{return!1}}function Qe(o,i){return me(o,i)&&!(Object.hasOwnProperty.call(o,i)&&Object.propertyIsEnumerable.call(o,i))}function Ke(o,i,r){var d={};return r.isMergeableObject(o)&&se(o).forEach(function(g){d[g]=F(o[g],r)}),se(i).forEach(function(g){Qe(o,g)||(me(o,g)&&r.isMergeableObject(i[g])?d[g]=Xe(g,r)(o[g],i[g],r):d[g]=F(i[g],r))}),d}function _(o,i,r){r=r||{},r.arrayMerge=r.arrayMerge||Ze,r.isMergeableObject=r.isMergeableObject||ze,r.cloneUnlessOtherwiseSpecified=F;var d=Array.isArray(i),g=Array.isArray(o),b=d===g;return b?d?r.arrayMerge(o,i,r):Ke(o,i,r):F(i,r)}_.all=function(i,r){if(!Array.isArray(i))throw new Error("first argument should be an array");return i.reduce(function(d,g){return _(d,g,r)},{})};var Je=_,et=Je;const ye=Fe(et),ae=async o=>{const i=await chrome.tabs.query({});if(Array.isArray(o)){const r=new Set(o);return i.filter(d=>{if(d.url){const g=Z(d.url);return g&&r.has(g)}})}else return i.filter(r=>r.url&&o===Z(r.url))},tt=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( \((?<engineDetails>.+?)\))?( (?<extensions>.+?))?$/,nt=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( (?<extensions>.+?))?/;class j{name;version;constructor(i,r){this.name=i,this.version=r}static parse(i){const r=i.split("/");return new j(r[0],r[1])}toString(){return this.version?`${this.name}/${this.version}`:this.name}setName(i){this.name=i}setVersion(i){this.version=i}}class rt{type;product;systemInfo;engine;engineDetails;extensions;constructor(i){let r;if(i.includes("Firefox")?(this.type="firefox",r=i.match(nt)?.groups):(this.type="base",r=i.match(tt)?.groups),!r)throw new Error("unable to parse");this.product=j.parse(r.product),this.systemInfo=r.systemInfo.split(";").map(d=>d.trim()),this.engine=r.engine?.split(" ").map(d=>j.parse(d)),this.engineDetails=r.engineDetails?.split(",").map(d=>d.trim()),this.extensions=r.extensions?.split(" ").map(d=>j.parse(d))}toString(i){let r;i?r=this.product.version:r=this.product.toString();const d=this.systemInfo.join("; "),g=this.engine?.map(v=>v.toString()).join(" "),b=this.extensions?.map(v=>v.toString()).join(" ");if(this.type==="firefox")return`${r} (${d}) ${g} ${b}`;{const v=this.engineDetails?.join(", ");return`${r} (${d}) ${g} (${v}) ${b}`}}}const ce=(o,i)=>({...i,version:i.version&&k(o,i.version).full}),ot=async(o,i)=>{if(!i.userAgentData||!i.userAgentData.brands)return{};const r={brands:i.userAgentData.brands.map(d=>ce(o,d))};if(i.userAgentData.getHighEntropyValues){const{fullVersionList:d,uaFullVersion:g}=await i.userAgentData.getHighEntropyValues(["fullVersionList","uaFullVersion"]);r.fullVersionList=d?.map(b=>ce(o,b)),r.uaFullVersion=g&&k(o,g).full}return r},le=new Map,it=(o,i,r)=>{const d=r?"app":"ua";let g=le.get(i.userAgent);if(g)return g[d];try{const b=new rt(i.userAgent);b.engine?.length&&b.engine.forEach(v=>v.version&&v.setVersion(k(o,v.version).full)),b.extensions?.length&&b.extensions.forEach(v=>v.version&&v.setVersion(k(o,v.version).full)),g={ua:b.toString(),app:b.toString(r)},le.set(i.userAgent,g)}catch{return r?i.appVersion:i.userAgent}return g[d]};function st(o,i){var r;(function(e){e[e.default=0]="default",e[e.value=1]="value",e[e.page=2]="page",e[e.browser=3]="browser",e[e.domain=4]="domain",e[e.global=5]="global",e[e.enabled=6]="enabled",e[e.disabled=7]="disabled"})(r||(r={}));var d;(function(e){e.SetConfig="set-config",e.GetNotice="get-notice",e.SetHookRecords="set-hook-records",e.UpdateWhitelist="update-whitelist",e.ChangeScriptWhitelist="change-script-whitelist",e.GetNewVersion="get-new-version"})(d||(d={}));var g;(function(e){e.SetConfig="set-config",e.SetHookRecords="set-hook-records",e.ChangeWhitelist="change-whitelist"})(g||(g={}));const b=function(){return Math.floor(w(Math.random()*1e6,Number.MAX_SAFE_INTEGER,1))},v=e=>{let t=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);t=(t<<5)-t+s,t=t&t}return t%Number.MAX_SAFE_INTEGER},P=function(e){try{let t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")return;let n=t.hostname,s=t.port;return s===""&&(t.protocol==="http:"?s="80":t.protocol==="https:"&&(s="443")),`${n}:${s}`}catch{return}},R=(e,t,n=100,s)=>{const[u,...c]=t.split(".");if(c.length===0)return{major:u,full:u};s=s??c.length;const a=[];for(let p=0;p<s;p++){const f=Number(c[p]);if(isNaN(f)){a.push(c[p]);continue}const l=Math.floor(w(e+p,n,0));a.push(l.toString())}return{major:u,full:[u,...a].join(".")}},w=function(e,t=1,n=0){typeof e=="string"&&(e=v(e));const s=233280;e=(e*9301+49297)%s,e<0&&(e+=s);const u=e/s;return n+u*(t-n)},$=(e,t)=>e[t%e.length],Se=(e,t)=>{const n=[...e];let s=n.length,u,c;const a=()=>{const p=Math.sin(t++)*1e4;return p-Math.floor(p)};for(;s;)c=Math.floor(a()*s--),u=n[s],n[s]=n[c],n[c]=u;return n},ve=e=>{const t=[];for(let n=0;n<10;n++)t.push(Math.floor(w(e++,255,0)));return t},we=e=>[w(e,1,-1),w(e+1,1,-1)],xe=(e,t)=>{const n=w((e+v(t))%Number.MAX_SAFE_INTEGER,3,0);return n*10%1<.9?0:Math.floor(n)-1},De=function(e,t){t=t||300;let n;return function(...s){clearTimeout(n),n=setTimeout(()=>e(...s),t)}},Re=function(e,t){t=t||300;const n=new Map;return function(s,...u){n.has(s)&&clearTimeout(n.get(s)),n.set(s,setTimeout(()=>{e(s,...u),n.delete(s)},t))}},Ce="__MyFingerprint__",Ee=e=>({[Ce]:e}),Pe=e=>{postMessage(Ee({type:g.SetHookRecords,data:e}),location.origin)},Ae=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( \((?<engineDetails>.+?)\))?( (?<extensions>.+?))?$/,Te=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( (?<extensions>.+?))?/;class O{name;version;constructor(t,n){this.name=t,this.version=n}static parse(t){const n=t.split("/");return new O(n[0],n[1])}toString(){return this.version?`${this.name}/${this.version}`:this.name}setName(t){this.name=t}setVersion(t){this.version=t}}class Me{type;product;systemInfo;engine;engineDetails;extensions;constructor(t){let n;if(t.includes("Firefox")?(this.type="firefox",n=t.match(Te)?.groups):(this.type="base",n=t.match(Ae)?.groups),!n)throw new Error("unable to parse");this.product=O.parse(n.product),this.systemInfo=n.systemInfo.split(";").map(s=>s.trim()),this.engine=n.engine?.split(" ").map(s=>O.parse(s)),this.engineDetails=n.engineDetails?.split(",").map(s=>s.trim()),this.extensions=n.extensions?.split(" ").map(s=>O.parse(s))}toString(t){let n;t?n=this.product.version:n=this.product.toString();const s=this.systemInfo.join("; "),u=this.engine?.map(a=>a.toString()).join(" "),c=this.extensions?.map(a=>a.toString()).join(" ");if(this.type==="firefox")return`${n} (${s}) ${u} ${c}`;{const a=this.engineDetails?.join(", ");return`${n} (${s}) ${u} (${a}) ${c}`}}}const V=(e,t)=>({...t,version:t.version&&R(e,t.version).full}),J=new Map,ee=(e,t,n)=>{const s=n?"app":"ua";let u=J.get(t.userAgent);if(u)return u[s];try{const c=new Me(t.userAgent);c.engine?.length&&c.engine.forEach(a=>a.version&&a.setVersion(R(e,a.version).full)),c.extensions?.length&&c.extensions.forEach(a=>a.version&&a.setVersion(R(e,a.version).full)),u={ua:c.toString(),app:c.toString(n)},J.set(t.userAgent,u)}catch{return n?t.appVersion:t.userAgent}return u[s]},z=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3],L=(e,t,n)=>{t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3]},te=(e,t,n,s,u,c,a,p)=>{const f=e.call(n,s,u,c,a,p);let l=0,h=!1;const m=new Uint8ClampedArray(4),S=new Uint8ClampedArray(4),y=new Uint8ClampedArray(4),x=new Uint8ClampedArray(4),I=new Uint8ClampedArray(4),D=f.data;e:for(let C=1;C<a-2;C+=2)for(let E=1;E<c-2;E+=2){if(t.length===l)break e;const ie=(C*c+E)*4;L(D,m,ie),L(D,S,((C-1)*c+E)*4),!z(m,S)&&(L(D,y,((C+1)*c+E)*4),!z(m,y)&&(L(D,x,(C*c+(E-1))*4),!z(m,x)&&(L(D,I,(C*c+(E+1))*4),!z(m,I)&&(D[ie+3]=t[l++]%256,h=!0))))}return h&&n.putImageData(f,s,u),f},_e=(e,t)=>{if(t)return new Proxy(t,{get:(n,s)=>{switch(s){case"brands":{const c=n[s];return c?.map?.(p=>V(e,p))??c}case"toJSON":{const c=n[s];return c&&new Proxy(c.bind(n),{apply:(a,p,f)=>{const l=a.apply(p,f);return l?.brands?.map?.(m=>V(e,m))??l}})}case"getHighEntropyValues":{const c=n[s];return c&&new Proxy(c.bind(n),{apply:(a,p,f)=>a.apply(p,f)?.then(l=>l&&{...l,brands:l.brands?.map?.(h=>V(e,h)),fullVersionList:l.fullVersionList?.map?.(h=>V(e,h)),uaFullVersion:l.uaFullVersion&&R(e,l.uaFullVersion).full})})}}const u=n[s];return typeof u=="function"?u.bind(n):u}})},ne=(e,t)=>{const n="attribute vec4 noise;void main() {gl_Position = noise;gl_PointSize = 0.001;}",s="void main() {gl_FragColor = vec4(0.0, 0.0, 0.0, 0.01);}",u=(m,S,y)=>{const x=m.createShader(S);if(x)return m.shaderSource(x,y),m.compileShader(x),x},c=u(e,e.VERTEX_SHADER,n),a=u(e,e.FRAGMENT_SHADER,s);if(!c||!a)return;const p=e.createProgram();if(!p)return;e.attachShader(p,c),e.attachShader(p,a),e.linkProgram(p),e.useProgram(p);const f=new Float32Array(t),l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,f,e.STATIC_DRAW);const h=e.getAttribLocation(p,"noise");e.enableVertexAttribArray(h),e.vertexAttribPointer(h,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1)},Oe=Object.entries({"iframe html hook":{condition:({conf:e})=>e.hookBlankIframe,onEnable:({win:e,hookIframe:t})=>{const n=new MutationObserver(u=>{if(u.length!=1)for(const c of u)for(const a of c.addedNodes)a.nodeName==="IFRAME"&&t(a)});n.observe(e.document.documentElement,{childList:!0,subtree:!0});const s=()=>{n.disconnect(),e.removeEventListener("DOMContentLoaded",s,{capture:!0}),e.removeEventListener("load",s,{capture:!0})};e.addEventListener("DOMContentLoaded",s,{capture:!0}),e.addEventListener("load",s,{capture:!0})}},"iframe script hook":{condition:({conf:e})=>e.hookBlankIframe,onEnable:({win:e,hookIframe:t})=>{const n=(a,p,f)=>{const l=a.apply(p,f),h=f[0];return h?.tagName==="IFRAME"&&t(h),l},s=e.Node.prototype.appendChild;e.Node.prototype.appendChild=new Proxy(s,{apply:n});const u=e.Node.prototype.insertBefore;e.Node.prototype.insertBefore=new Proxy(u,{apply:n});const c=e.Node.prototype.replaceChild;e.Node.prototype.replaceChild=new Proxy(c,{apply:n})}},"hook navigator":{condition:({conf:e,isAllDefault:t})=>!t(e.fingerprint.navigator)||e.fingerprint.other.webrtc.type!==r.default,onEnable:({win:e,conf:t,getSeed:n,getValue:s})=>{const u=Object.getOwnPropertyDescriptor(e,"navigator")?.get;u&&Object.defineProperty(e,"navigator",{get:new Proxy(u,{apply:(c,a,p)=>{const f=u.call(a);return new Proxy(f,{get:(l,h)=>{switch(h){case"userAgent":{const S=n(t.fingerprint.navigator.equipment.type);if(S!==null)return T(h),ee(S,l)}case"appVersion":{const S=n(t.fingerprint.navigator.equipment.type);if(S!==null)return T(h),ee(S,l,!0)}case"userAgentData":{const S=n(t.fingerprint.navigator.equipment.type);if(S!==null)return T(h),_e(S,l[h])}case"getUserMedia":case"mozGetUserMedia":case"webkitGetUserMedia":{if(t.fingerprint.other.webrtc.type===r.disabled)return;break}case"mediaDevices":{if(t.fingerprint.other.webrtc.type===r.disabled)return null;break}case"languages":case"hardwareConcurrency":{const S=t.fingerprint.navigator[h],y="navigator."+h,x=s(y,S);if(x!==null)return x}}const m=l[h];return typeof m=="function"?m.bind(l):m}})}})})}},"hook screen":{condition:({conf:e,isAllDefault:t})=>!t(e.fingerprint.screen),onEnable:({win:e,conf:t,getValue:n})=>{const s=Object.getOwnPropertyDescriptor(e,"screen")?.get;s&&Object.defineProperty(e,"screen",{get:new Proxy(s,{apply:(u,c,a)=>{const p=s.call(c);return new Proxy(p,{get:(f,l)=>{switch(l){case"width":case"height":case"colorDepth":case"pixelDepth":{const m=t.fingerprint.screen[l],S="screen."+l,y=n(S,m);if(y!==null)return y}}const h=f[l];return typeof h=="function"?h.bind(f):h}})}})})}},"hook canvas":{condition:({conf:e})=>e.fingerprint.other.canvas.type!==r.default,onEnable:({win:e,conf:t,rawObjects:n,getValue:s})=>{const u=e.HTMLCanvasElement.prototype.getContext;e.HTMLCanvasElement.prototype.getContext=new Proxy(u,{apply:(a,p,f)=>{if(f[0]==="2d"){const l=f[1]??{};l.willReadFrequently=!0,f[1]=l}return a.apply(p,f)}});const c=e.CanvasRenderingContext2D.prototype.getImageData;n.getImageData=c,e.CanvasRenderingContext2D.prototype.getImageData=new Proxy(c,{apply:(a,p,f)=>{const l=s("other.canvas",t.fingerprint.other.canvas);return l!==null?te(c,l,p,...f):a.apply(p,f)}})}},"hook webgl":{condition:({conf:e})=>e.fingerprint.other.webgl.type!==r.default,onEnable:({win:e,conf:t,getValue:n})=>{{const s=e.WebGLRenderingContext.prototype.readPixels,u=e.WebGL2RenderingContext.prototype.readPixels,c={apply:(a,p,f)=>{const l=n("other.webgl",t.fingerprint.other.webgl);return l&&ne(p,l),a.apply(p,f)}};e.WebGLRenderingContext.prototype.readPixels=new Proxy(s,c),e.WebGL2RenderingContext.prototype.readPixels=new Proxy(u,c)}{const s=e.WebGLRenderingContext.prototype.getSupportedExtensions,u=e.WebGL2RenderingContext.prototype.getSupportedExtensions,c={apply:(a,p,f)=>{const l=a.apply(p,f);if(l){const h=n("other.webgl",t.fingerprint.other.webgl);l.push?.("EXT_"+h[0]+h[1])}return l}};e.WebGLRenderingContext.prototype.getSupportedExtensions=new Proxy(s,c),e.WebGL2RenderingContext.prototype.getSupportedExtensions=new Proxy(u,c)}}},"hook toDataURL":{condition:({conf:e})=>e.fingerprint.other.canvas.type!==r.default||e.fingerprint.other.webgl.type!==r.default,onEnable:({win:e,conf:t,rawObjects:n,getValue:s})=>{const u=e.HTMLCanvasElement.prototype.toDataURL;e.HTMLCanvasElement.prototype.toDataURL=new Proxy(u,{apply:(c,a,p)=>{if(t.fingerprint.other.canvas.type!==r.default){const f=a.getContext("2d");if(f){const l=s("other.canvas",t.fingerprint.other.canvas);return l&&n.getImageData&&te(n.getImageData,l,f,0,0,a.width,a.height),c.apply(a,p)}}if(t.fingerprint.other.webgl.type!==r.default){const f=a.getContext("webgl")??a.getContext("webgl2");if(f){const l=s("other.webgl",t.fingerprint.other.webgl);return l&&ne(f,l),c.apply(a,p)}}return c.apply(a,p)}})}},"hook audio":{condition:({conf:e})=>e.fingerprint.other.audio.type!==r.default,onEnable:({win:e,conf:t,random:n})=>{const s=e.OfflineAudioContext.prototype.createDynamicsCompressor;e.OfflineAudioContext.prototype.createDynamicsCompressor=new Proxy(s,{apply:(u,c,a)=>{const p=n("other.audio",t.fingerprint.other.audio);if(p===null)return u.apply(c,a);const f=u.apply(c,a),l=c.createGain();return l.gain.value=p*.001,f.connect(l),l.connect(c.destination),f}})}},"hook timezone":{condition:({conf:e})=>e.fingerprint.other.timezone.type!==r.default,onEnable:({win:e,conf:t,getValueDebounce:n})=>{const s=e.Intl.DateTimeFormat,u=e.Date,c=(a,p)=>{const f=new s("en-US",{timeZone:p??"Asia/Shanghai",weekday:"short",month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hour12:!1,timeZoneName:"longOffset"});try{return f.formatToParts(a).reduce((h,m)=>(h[m.type]=m.value,h),{})}catch{return null}};e.Intl.DateTimeFormat=new Proxy(s,{construct:(a,p,f)=>{const l=n("other.timezone",t.fingerprint.other.timezone);return p[0]=p[0]??l.locale,p[1]=Object.assign({timeZone:l.zone},p[1]),new a(...p)},apply:(a,p,f)=>{const l=n("other.timezone",t.fingerprint.other.timezone);return f[0]=f[0]??l.locale,f[1]=Object.assign({timeZone:l.zone},f[1]),a.apply(p,f)}}),e.Date=new Proxy(u,{apply:(a,p,f)=>new a(...f).toString()});{const a=e.Date.prototype.getTimezoneOffset,p=e.Date.prototype.toString,f=e.Date.prototype.toDateString,l=e.Date.prototype.toTimeString,h=m=>({apply:(S,y,x)=>{const I=n("other.timezone",t.fingerprint.other.timezone);if(I===null)return S.apply(y,x);const D=m(y,I);return D===null?S.apply(y,x):D}});e.Date.prototype.getTimezoneOffset=new Proxy(a,h((m,S)=>S.offset*-60)),e.Date.prototype.toString=new Proxy(p,h((m,S)=>{const y=c(m,S.zone);return y===null?null:`${y.weekday} ${y.month} ${y.day} ${y.year} ${y.hour}:${y.minute}:${y.second} ${y.timeZoneName?.replace(":","")}`})),e.Date.prototype.toDateString=new Proxy(f,h((m,S)=>{const y=c(m,S.zone);return y===null?null:`${y.weekday} ${y.month} ${y.day} ${y.year}`})),e.Date.prototype.toTimeString=new Proxy(l,h((m,S)=>{const y=c(m,S.zone);return y===null?null:`${y.hour}:${y.minute}:${y.second} ${y.timeZoneName?.replace(":","")}`}))}{const a=e.Date.prototype.toLocaleString,p=e.Date.prototype.toLocaleDateString,f=e.Date.prototype.toLocaleTimeString,l={apply:(h,m,S)=>{const y=n("other.timezone",t.fingerprint.other.timezone);return y&&(S[0]=S[0]??y.locale,S[1]=Object.assign({timeZone:y.zone},S[1])),h.apply(m,S)}};e.Date.prototype.toLocaleString=new Proxy(a,l),e.Date.prototype.toLocaleDateString=new Proxy(p,l),e.Date.prototype.toLocaleTimeString=new Proxy(f,l)}}},"hook webrtc":{condition:({conf:e})=>e.fingerprint.other.webrtc.type!==r.default,onEnable:({win:e})=>{e.RTCDataChannel&&(e.RTCDataChannel=void 0),e.RTCIceCandidate&&(e.RTCIceCandidate=void 0),e.RTCConfiguration&&(e.RTCConfiguration=void 0),e.MediaStreamTrack&&(e.MediaStreamTrack=void 0),e.RTCPeerConnection&&(e.RTCPeerConnection=void 0),e.RTCSessionDescription&&(e.RTCSessionDescription=void 0),e.RTCDataChannel&&(e.RTCDataChannel=void 0),e.mozMediaStreamTrack&&(e.mozMediaStreamTrack=void 0),e.mozRTCPeerConnection&&(e.mozRTCPeerConnection=void 0),e.mozRTCSessionDescription&&(e.mozRTCSessionDescription=void 0),e.webkitMediaStreamTrack&&(e.webkitMediaStreamTrack=void 0),e.webkitRTCPeerConnection&&(e.webkitRTCPeerConnection=void 0),e.webkitRTCSessionDescription&&(e.webkitRTCSessionDescription=void 0)}},"hook font":{condition:({conf:e})=>e.fingerprint.other.font.type!==r.default,onEnable:({win:e,conf:t,getValueDebounce:n})=>{const s=Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,"offsetHeight")?.get;s&&Object.defineProperty(e.HTMLElement.prototype,"offsetHeight",{get:new Proxy(s,{apply(c,a,p){try{const f=s.call(a),l=a.style.fontFamily??"h"+f,h=n("other.font",t.fingerprint.other.font,l);return f+h}catch{return s.call(a)}}})});const u=Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,"offsetWidth")?.get;u&&Object.defineProperty(e.HTMLElement.prototype,"offsetWidth",{get:new Proxy(u,{apply(c,a,p){try{const f=u.call(a),l=a.style.fontFamily??"w"+f,h=n("other.font",t.fingerprint.other.font,l);return f+h}catch{return u.call(a)}}})})}},"hook webgpu":{condition:({conf:e})=>e.fingerprint.other.webgpu.type!==r.default,onEnable:({win:e,conf:t,randomDebounce:n})=>{if(e.GPUAdapter)try{const s=(c,a)=>{const p=n("other.webgpu",t.fingerprint.other.webgpu,a,1,64);return c&&c-Math.floor(p)},u=Object.getOwnPropertyDescriptor(e.GPUAdapter.prototype,"limits")?.get;u&&Object.defineProperty(e.GPUAdapter.prototype,"limits",{get:new Proxy(u,{apply(c,a,p){const f=c.apply(a,p);return new Proxy(f,{get(l,h){const m=l[h];switch(h){case"maxBufferSize":return s(m,0);case"maxStorageBufferBindingSize":return s(m,1)}return typeof m=="function"?m.bind(l):m}})}})})}catch{}if(e.GPUDevice)try{const s=(c,a)=>{const p=n("other.webgpu",t.fingerprint.other.webgpu,a,1,64);return c&&c-Math.floor(p)},u=Object.getOwnPropertyDescriptor(e.GPUDevice.prototype,"limits")?.get;u&&Object.defineProperty(e.GPUDevice.prototype,"limits",{get:new Proxy(u,{apply(c,a,p){const f=c.apply(a,p);return new Proxy(f,{get(l,h){const m=l[h];switch(h){case"maxBufferSize":return s(m,0);case"maxStorageBufferBindingSize":return s(m,1)}return typeof m=="function"?m.bind(l):m}})}})})}catch{}if(e.GPUCommandEncoder?.prototype?.beginRenderPass)try{e.GPUCommandEncoder.prototype.beginRenderPass=new Proxy(e.GPUCommandEncoder.prototype.beginRenderPass,{apply(s,u,c){if(c?.[0]?.colorAttachments?.[0]?.clearValue)try{const a=c[0].colorAttachments[0].clearValue;let p=0;for(let f in a){let l=a[f];const h=n("other.webgpu",t.fingerprint.other.webgpu,p++,.01,.001);l+=l*h*-1,a[f]=Math.abs(l)}c[0].colorAttachments[0].clearValue=a}catch{}return s.apply(u,c)}})}catch{}if(e.GPUQueue?.prototype?.writeBuffer)try{e.GPUQueue.prototype.writeBuffer=new Proxy(e.GPUQueue.prototype.writeBuffer,{apply(s,u,c){const a=c?.[2];if(a&&a instanceof Float32Array)try{const p=Math.ceil(a.length*.05);let f=0;const l=Array(a.length).map((h,m)=>m).sort(()=>n("other.webgpu",t.fingerprint.other.webgpu,f++,1,-1)).slice(0,p);f=0;for(let h=0;h<l.length;h++){const m=l[h];let S=a[m];const y=n("other.webgpu",t.fingerprint.other.webgpu,f++,1e-4,-1e-4);a[m]+=y*S}}catch{}return s.apply(u,c)}})}catch{}}}}).map(([e,t])=>({...t,name:e})),A={languages:navigator.languages,width:screen.width,height:screen.height},q={hardwareConcurrencys:[8,12,16],colorDepths:[16,24,32],pixelDepths:[16,24,32]},Le={"navigator.language":e=>$(A.languages,e),"navigator.languages":e=>Se(A.languages,e),"navigator.hardwareConcurrency":e=>$(q.hardwareConcurrencys,e),"screen.height":e=>{const t=e%100-50,n=A.width+t;return Math.round(n*A.height/A.width)},"screen.width":e=>{const t=e%100-50;return A.width+t},"screen.colorDepth":e=>$(q.colorDepths,e),"screen.pixelDepth":e=>$(q.pixelDepths,e),"other.canvas":ve,"other.audio":void 0,"other.webgl":we,"other.font":xe,"other.webgpu":void 0},Ie={"other.timezone":void 0},H=new Map,Ne=De(()=>{Pe(Object.fromEntries(H))}),T=function(e){const t=e.split(".");e=t[t.length-1];const n=H.get(e)??0;H.set(e,n+1),Ne()},re=Re(T,200);class W{win;info;seed;conf;rawObjects={};constructor(t,n,s){if(this.win=t,this.info=n,this.conf=s,this.seed={page:Math.floor(w(n.tabId,Number.MAX_SAFE_INTEGER,1)),domain:Math.floor(w(n.host,Number.MAX_SAFE_INTEGER,1)),browser:s.browserSeed??b(),global:s.customSeed??b()},!t)return;const u="__MyFingerprint__"+n.tabId;t[u]||(t[u]=!0,this.hook())}isEnable(){return!!this.conf.enable&&!this.info.inWhitelist}hook(){if(this.isEnable())for(const t of Oe)(!t.condition||t.condition(this)===!0)&&t.onEnable?.(this)}hookIframe=t=>{new W(t.contentWindow,this.info,this.conf)};isAllDefault(t){if(!t)return!0;for(const n of Object.values(t))if(n.type!==r.default)return!1;return!0}getSeed=t=>{switch(t){case r.page:return this.seed.page;case r.domain:return this.seed.domain;case r.browser:return this.seed.browser;case r.global:return this.seed.global;case r.default:default:return null}};_getValue=(t,n,s)=>{switch(n.type){case r.default:return null;case r.value:{const u=Ie[t];return u?u(n.value,s):n.value}case r.browser:case r.domain:case r.global:case r.page:{const u=Le[t];if(u){const c=this.getSeed(n.type);if(c!==null)return u(c,s)}return null}default:return null}};getValue=(t,n,s)=>n?(T(t),this._getValue(t,n,s)):null;getValueDebounce=(t,n,s)=>n?(re(t),this._getValue(t,n,s)):null;random=(t,n,s=0,u=1,c=0)=>{T(t);const a=this.getSeed(n?.type);return a===null?null:w(a+s*10,u,c)};randomDebounce=(t,n,s=0,u=1,c=0)=>{re(t);const a=this.getSeed(n?.type);return a===null?null:w(a+s*10,u,c)}}const je=o,oe=i;(()=>{const e=P(location.href);e&&new W(window,{tabId:je,host:e,inWhitelist:oe.whitelist.includes(e)},oe.config)})()}const ue=1,at=["timezone","canvas","audio","font","webgl","webrtc","webgpu"];let B;const pe=new Map,ct={languages:navigator.languages},Y={whitelist:"#fff",low:"#7FFFD4",high:"#F4A460"};let G;const fe=()=>{const o=chrome.runtime.getManifest(),i={type:M.default},r={type:M.browser},d=X();return{version:o.version,config:{enable:!0,customSeed:d,browserSeed:X(),customSeedInput:String(d),fingerprint:{navigator:{equipment:i,language:i,languages:i,hardwareConcurrency:i},screen:{height:i,width:i,colorDepth:i,pixelDepth:i},other:{timezone:i,canvas:r,audio:i,webgl:r,webrtc:i,font:i,webgpu:i}},language:navigator.language,hookNetRequest:!0,hookBlankIframe:!0},whitelist:[]}},Q=Ue(async o=>{o=o??chrome.runtime.getManifest().version;const i=await chrome.storage.local.get();let r;return!i.version||$e(o,"2.0.0")<0?(await chrome.storage.local.clear(),r=fe()):(r=ye(fe(),i),r.config.browserSeed=X()),B={...r,whitelist:new Set(r.whitelist)},chrome.storage.local.set(r).then(()=>K()),B}),U=async()=>B||await Q(),lt=async()=>G||(G=(await fetch("https://api.github.com/repos/omegaee/my-fingerprint/releases/latest").then(i=>i.json())).tag_name,G),de=(o,i)=>{switch(i?.type){case M.browser:return o.config.browserSeed;case M.global:return o.config.customSeed;default:return}},K=async()=>{const o=await U(),i={removeRuleIds:[ue]};if(!o.config.enable||!o.config.hookNetRequest){chrome.declarativeNetRequest.updateSessionRules(i);return}const r=[],d=de(o,o.config.fingerprint.navigator.equipment);if(d){r.push({header:"User-Agent",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:it(d,navigator)});const b=await ot(d,navigator);b.brands&&r.push({header:"Sec-Ch-Ua",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:b.brands.map(v=>`"${v.brand}";v="${v.version}"`).join(", ")}),b.fullVersionList&&r.push({header:"Sec-Ch-Ua-Full-Version-List",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:b.fullVersionList.map(v=>`"${v.brand}";v="${v.version}"`).join(", ")}),b.uaFullVersion&&r.push({header:"Sec-Ch-Ua-Full-Version",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:b.uaFullVersion})}const g=o.config.fingerprint.navigator.languages;if(g&&g.type!==M.default){let b;if(g.type===M.value)b=g.value;else{const v=de(o,g);v&&(b=Ve(ct.languages,v))}if(b?.length){const[v,...P]=b;let R=1;for(let w=0;w<P.length&&R>.1;w++)R-=.1,P[w]=`${P[w]};q=${R.toFixed(1)}`;r.push({header:"Accept-Language",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:[v,...P].join(",")})}}r.length&&(i.addRules=[{id:ue,condition:{excludedInitiatorDomains:[...new Set([...o.whitelist].map(b=>b.split(":")[0]))],resourceTypes:Object.values(chrome.declarativeNetRequest.ResourceType)},action:{type:chrome.declarativeNetRequest.RuleActionType.MODIFY_HEADERS,requestHeaders:r}}]),chrome.declarativeNetRequest.updateSessionRules(i)},ut=ge(o=>{chrome.storage.local.set({config:o.config})},500),pt=ge(o=>{chrome.storage.local.set({whitelist:[...o.whitelist]})},500),ft=async o=>{const i=await U();i.config=ye(i.config,o,{arrayMerge:(r,d,g)=>d}),ut(i),(o.enable!==void 0||o.hookNetRequest!==void 0||o.fingerprint?.navigator?.equipment!==void 0||o.fingerprint?.navigator?.language!==void 0)&&K()},he=async(o,i)=>{const r=await U();if(Array.isArray(i)){if(o==="add")for(const d of i)r.whitelist.add(d);else if(o==="del")for(const d of i)r.whitelist.delete(d)}else o==="add"?r.whitelist.add(i):o==="del"&&r.whitelist.delete(i);pt(r),r.config.enable&&r.config.hookNetRequest&&r.config.fingerprint.navigator.equipment&&K()},dt=o=>{let i=0,r=0;for(const[g,b]of Object.entries(o))at.includes(g)?r+=b:i+=b;const d=r||i;return[d>=100?"99+":String(d),r?Y.high:Y.low]},be=o=>{chrome.action.setBadgeText({tabId:o,text:" "}),chrome.action.setBadgeBackgroundColor({tabId:o,color:Y.whitelist})},ht=o=>{chrome.action.setBadgeText({tabId:o,text:""})};chrome.runtime.onInstalled.addListener(({reason:o,previousVersion:i})=>{(o===chrome.runtime.OnInstalledReason.INSTALL||o===chrome.runtime.OnInstalledReason.UPDATE)&&Q(i)});chrome.runtime.onStartup.addListener(()=>{Q(chrome.runtime.getManifest().version)});chrome.runtime.onMessage.addListener((o,i,r)=>{switch(o.type){case N.SetConfig:{ft(o.config);break}case N.GetNotice:return U().then(d=>{const g=d.whitelist.has(o.host);r(g?{type:"whitelist"}:{type:"record",data:pe.get(o.tabId)})}),!0;case N.SetHookRecords:{const d=i.tab?.id;if(d===void 0)return;pe.set(d,o.data);const[g,b]=dt(o.data);chrome.action.setBadgeText({tabId:d,text:g}),chrome.action.setBadgeBackgroundColor({tabId:d,color:b});break}case N.UpdateWhitelist:{o.mode==="add"?(he("add",o.host),ae(o.host).then(d=>d.forEach(g=>{g.id&&be(g.id)}))):o.mode==="del"&&(he("del",o.host),ae(o.host).then(d=>d.forEach(g=>{g.id&&ht(g.id)})));break}case N.GetNewVersion:return lt().then(d=>{r(d)}),!0}});const gt=(o,i)=>{chrome.scripting.executeScript({target:{tabId:o,allFrames:!0},world:"MAIN",injectImmediately:!0,args:[o,{...i,whitelist:[...i.whitelist]}],func:st}).catch(()=>{})},mt=(o,i)=>{const r=Z(i);r&&U().then(d=>{gt(o,d),d.whitelist.has(r)&&be(o)})};chrome.tabs.onUpdated.addListener((o,i,r)=>{r.url&&i.status==="loading"&&mt(o,r.url)});
